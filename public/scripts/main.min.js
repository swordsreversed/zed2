"use strict";var zed2app=zed2app||angular.module("zed2App",["ngCookies","ngResource","ngSanitize","ngRoute","ngAnimate","ui.router","mm.foundation","ui.bootstrap","ui.select2"]).config(function(e,t,r){t.otherwise("/home");var a="partials",n={name:"subscribers","abstract":!0,url:"/subscribers",templateUrl:a+"/subscriber.html",controller:"SubscriberCtrl"},s={name:"subscribers.list",parent:n,url:"",templateUrl:a+"/sublist.html"},c={name:"subscribers.details",parent:n,url:"/:id",templateUrl:a+"/subdetails.html",controller:"SubDetailsCtrl"},o={name:"subscribers.new",parent:n,url:"/new",templateUrl:a+"/subdetails.html",controller:"SubDetailsCtrl"};e.state("home",{url:"/home",templateUrl:a+"/home.html",controller:"HomeCtrl"}).state(n).state(s).state(c).state(o).state("releases",{url:"/releases",templateUrl:a+"/release.html",controller:"ReleaseCtrl"}).state("releases.list",{parent:n,url:"",templateUrl:a+"/releaselist.html"}).state("releases.detail",{url:"/:id",templateUrl:a+"/releasedetails.html",controller:"ReleaseDetailCtrl",resolve:{release:function(e,t,r){var a=r.defer();return e.get({id:t.id},function(e){a.resolve(e)}),a.promise}}}).state("releases.new-artist",{url:"/new/release/:artist",templateUrl:a+"/releasedetails.html",controller:"ReleaseDetailCtrl",resolve:{release:function(){return{}}}}).state("releases.new",{url:"/new/release",templateUrl:a+"/releasedetails.html",controller:"ReleaseDetailCtrl",resolve:{release:function(){return{}}}}).state("contacts",{url:"/contacts",templateUrl:a+"/contact.html",controller:"ContactCtrl"}).state("contacts.details",{url:"/:id",templateUrl:a+"/contactdetails.html",controller:"ContactDetailsCtrl",resolve:{contact:function(e,t,r){var a=r.defer();return e.get({id:t.id},function(e){a.resolve(e)}),a.promise}}}).state("contacts.new",{url:"/new/contact",templateUrl:a+"/contactdetails.html",controller:"ContactDetailsCtrl",resolve:{contact:function(){return{}}}}),r.html5Mode(!0)});zed2app.directive("ngUppercaseInput",function(){return{require:"ngModel",link:function(e,t,r,a){var n=function(e){if(e){var t=e.toUpperCase();return t!==e&&(a.$setViewValue(t),a.$render()),t}};a.$parsers.push(n),n(e[r.ngModel])}}}).directive("ngUppercaseInput2",function(){return{require:"ngModel",link:function(e,t,r,a){var n=function(e){var r=t[0].selectionStart;if(e){var n=e.toUpperCase();return n!==e&&(a.$setViewValue(n),a.$render()),t[0].selectionStart=t[0].selectionEnd=r,n}};a.$parsers.push(n),n(e[r.ngModel])}}});var apiSrc="api/v1";zed2app.factory("SubService",function(e){return e(apiSrc+"/subscribers/:id",{id:"@subnumber"},{update:{method:"PUT"}})}).factory("ReleaseService",function(e){return e(apiSrc+"/releases/:id",{id:"@id"},{update:{method:"PUT"}})}).factory("ContactService",function(e){return e(apiSrc+"/contacts/:id",{id:"@contact_no"},{update:{method:"PUT"}})}).factory("SubtypesService",function(e){return e(apiSrc+"/subtypes/:id",{id:"@id"},{update:{method:"PUT"}})}).factory("ProgramService",function(e){return e(apiSrc+"/programs/:id",{id:"@id"},{update:{method:"PUT"}})}).factory("GenresService",function(e){return e(apiSrc+"/genres/:id",{id:"@genre_id"},{update:{method:"PUT"}})}).factory("ThemesService",function(e){return e(apiSrc+"/themes/:id",{id:"@theme_id"},{update:{method:"PUT"}})}).factory("GenresNewService",function(e){return e(apiSrc+"/genresnew/:id",{id:"@id"},{update:{method:"PUT"}})}).factory("DepartmentsService",function(e){return e(apiSrc+"/departments/:id",{id:"@department_no"},{update:{method:"PUT"}})}).factory("InterestsService",function(e){return e(apiSrc+"/interests/:id",{id:"@interest_no"},{update:{method:"PUT"}})}),zed2app.controller("ContactCtrl",function(e,t,r,a,n,s){t.contactSearchFormData={};var c="/api/v1";t.contactsuggest=function(e){return r.get(c+"contactsuggest/"+e).then(function(e){return e.data})},t.search=function(){if(t.contactSearchForm.$dirty===!0){var r=t.contactSearchFormData;t.contacts=s.query(r,function(){t.predicate="createddate",e.contactParams=r})}else console.log("no search shit!")},t.clearForm=function(){a.path("/contacts"),t.contactSearchFormData={},t.contactSearchFormData.interest_sun=[],t.contactSearchForm.$setPristine(),delete e.contactParams,t.contacts={}},t.addNew=function(){a.path("/contacts/new/contact")}}),zed2app.controller("ContactDetailsCtrl",function(e,t,r,a,n,s,c,o,l){t.alerts=[],t.consuggest=[],t.submitType="/contacts/new/contact"==a.path()?"Add Contact":"Update";t.contact=n.id?l:new s,t.saveContact=function(){n.id?t.contact.$update({id:n.id},function(){t.alerts.length>0&&t.alerts.splice(0,1),t.alerts.push({msg:"Contact "+n.id+" Updated!"}),t.contact=s.get({id:n.id}),$anchorScroll()},function(){console.log("Couldnt update!")}):t.contact.$save(function(){alert("Contact added"),a.path("/contacts/"+t.contact.contact_no)})},t.deleteContact=function(){var e="Warning",r="Are you sure you wish to delete this record?",s=[{result:"cancel",label:"Cancel"},{result:"ok",label:"OK",cssClass:"btn-primary"}];$dialog.messageBox(e,r,s).open().then(function(e){"ok"===e&&t.contact.$delete({id:n.id},function(){alert("Record deleted"),a.path("/contacts")})})},t.closeAlert=function(e){t.alerts.splice(e,1)},t.onSuburbChange=function(e){t.contact.postcode=e.postcode,t.contact.state=e.state}}),zed2app.controller("HomeCtrl",function(){}),zed2app.controller("ReleaseCtrl",function(e,t,r,a,n,s,c,o,l,i){t.releaseSearchFormData={};var u="/api/v1";t.ausnz=["A","NZ"],t.format=["CD","DIGITAL","VINYL"],t.extendedFormats=[{format_srch:"CD",format_desc:"CD"},{format_srch:"DIGITAL",format_desc:"DIGITAL"},{format_srch:"LP",format_desc:"VINYL LP"},{format_srch:'7"',format_desc:'VINYL 7"'}],t.artistsuggest=function(e){return r.get(u+"/artistsuggest/"+e).then(function(e){return e.data})},t.titlesuggest=function(e){return r.get(u+"/titlesuggest/"+e).then(function(e){return l(e.data,15)})},t.labelsuggest=function(e){return r.get(u+"/labelsuggest/"+e).then(function(e){return l(e.data,15)})},t.aprasuggest=function(e){return r.get(u+"/aprasuggest/"+e).then(function(e){return l(e.data,15)})},t.search=function(){if(t.releaseSearchForm.$dirty===!0){var r=t.releaseSearchFormData;t.releases=s.query(r,function(){t.predicate="release_year",t.artistname=n.name,e.releaseParams=r})}else console.log("no search shit!")},t.clearForm=function(){a.path("/releases"),t.releaseSearchFormData={},t.releaseSearchForm.$setPristine(),delete e.releaseParams,t.releases={}},t.addNew=function(){a.path(t.releaseSearchFormData.artist_nm?"/releases/new/release/"+t.releaseSearchFormData.artist_nm:"/releases/new/release")},t.convertDate=function(e){console.log(e),t.cDate=i("date")(new Date(e),"y-MM-dd")}}),zed2app.controller("ReleaseDetailCtrl",function(e,t,r,a,n,s,c,o,l,i,u){t.release=n.id?u:new s;var d="/api/v1";t.submitType=n.id?"Update":"Add Release",t.alerts=[],t.relsuggest=[],t.ausnz=["A","NZ"],t.promo=["Promo Campaign","Staff Pick","Other"],t.format=["CD","DIGITAL","VINYL"],t.status=["In Library","Received","Culled","Rejected"],t.genresnew=c.query(function(){if(t.release.genres){var e=function(){t.gs=_.pluck(t.release.genres,"id")};$timeout(e,300)}}),t.relCheck=function(e,a){r.get(d+"/relcheck/"+e+"/"+a).then(function(e){t.relsuggest=e.data})},t.labels=function(e){return r.get(d+"/labelsuggest/"+e).then(function(e){return l(e.data,15)})},t.saveRelease=function(){t.release.genres=t.gs,n.id?t.release.$update({id:n.id},function(){t.alerts.length>0&&t.alerts.splice(0,1),t.alerts.push({msg:"Record "+n.id+" Updated!"}),t.release=s.get({id:n.id}),$anchorScroll()},function(){alert("Couldnt update!")}):t.release.$save(function(){alert("Record added"),a.path("/releases/"+t.release.library_no)})},t.deleteRelease=function(){var e="Warning",r="Are you sure you wish to delete this record?",s=[{result:"cancel",label:"Cancel"},{result:"ok",label:"OK",cssClass:"btn-primary"}];$dialog.messageBox(e,r,s).open().then(function(e){"ok"===e&&t.release.$delete({id:n.id},function(){alert("Record deleted"),a.path("/releases")})})},t.closeAlert=function(e){t.alerts.splice(e,1)},t.add=function(){a.path("/releases/new/release")}}),zed2app.controller("SubDetailsCtrl",function(e,t,r,a,n,s,c){e.sub=n.get({id:r.id},function(t){e.fullname=t.subfirstname+" "+t.sublastname});var o="/api/v1";e.subtypes=s.query(),e.programs=c.query(),e.gender=[{id:1,desc:"MALE"},{id:2,desc:"FEMALE"},{id:3,desc:"TRANS"}],e.suburbsuggest=function(e){return t.get(o+"/suburbsuggest/"+e).then(function(e){return e.data})},e.saveSub=function(){e.subForm.$valid?e.sub.subnumber?e.sub.$update({id:r.id},function(t){e.saved="Subscriber updated!",e.sub=t}):e.sub.$save(function(t){a.path("/subscribers/"+t.subnumber),e.saved="Subscriber saved!"}):console.log("nope")},e.onSuburbChange=function(t){console.log(e.sub.suburb_id),console.log(t),e.sub.suburb_id=t.postcode,angular.extend(e.sub.suburb,t),console.log(e.sub.suburb)}}),zed2app.controller("SubscriberCtrl",function(e,t,r,a,n,s){e.subscriberSearchFormData={};e.isAdvanced=!1,e.subsuggest=function(e){return t.get("api/v1/subsuggest/"+e).then(function(e){var t=[];return angular.forEach(e.data,function(e){t.push(e.sublastname+", "+e.subfirstname+" "+e.subnumber)}),t})},e.search=function(){if(e.subscriberSearchForm.$dirty===!0){if(e.sub={},e.subs=[],e.subscriberSearchFormData.subName){var t=/^\w*,\s\w*\s(\d*)/,r=e.subscriberSearchFormData.subName.match(t);if(r)return void(e.sub=n.get({id:r[1]}))}var a=e.subscriberSearchFormData;e.subs=n.query(a,function(){e.predicate="createddate"})}else console.log("no search shit!")},e.clearForm=function(){s.path("/subscribers"),delete a.subscriberParams,delete a.subName,e.subs={},e.sub={},e.subscriberSearchFormData={},e.subscriberSearchForm.$setPristine()},e.addNew=function(){e.sub={},s.path("/subscribers/new")},e.selectSub=function(t){_(e.subs).forEach(function(e){e.selected=!1,t===e&&(t.selected=!0)})}}),angular.module("zed2App").controller("TestCtrl",function(e,t){t.get("/api/awesomeThings").success(function(t){e.awesomeThings=t})});